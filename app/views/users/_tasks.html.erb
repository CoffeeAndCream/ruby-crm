<div class="container info-card"  style="margin-top: -10px">
  <i class="material-icons" style="font-size: 36px">info</i>
  <div id="lead-tracking-table">
    <div class="row">
      <div class="col-md-10 col-md-offset-1">
        <h2>Tasks</h2>
        <h5 style="text-align: center"><i> If you see a task here, but the lead isn't assigned to you, contact your administrator so you can be place on the lead</i></h5>
        <br>
        <div id="task-table">
          <table class="table table-hover table-bordered table-responsive table-striped">
            <thead>
              <th>Event</th>
              <th>Appointment Time</th>
              <th>Task</th>
              <th>Action</th>
            </thead>
            <tbody>
            <% @events.where.not(:lead_id => nil).where(:user_id => @user.id).each do |event| %>
            <% lead = Lead.find_by_id(event.lead_id) %>
              <% if !event.future_event? && lead.lead_task == 'Rehash' || lead.lead_task.nil? %>
                <tr id='lead-task-<%=lead.id.to_s%>'>
                  <td style="text-align: center"><%= lead.fullname %></td>
                  <td style="text-align: center"><%= event.ends.strftime("%m/%d/%Y - %H:%m %p") %></td>
                  <td style="text-align: center">Follow up on Lead</td>
                  <td style="text-align: center">
                    <%= bootstrap_form_for lead, url: lead_lead_task_path(lead) do |f| %>
                      <%= f.form_group :lead_task, remote: true do %>
                        <%= f.radio_button :lead_task, "NG", id: 'NG', label: "NG", inline: true, class: 'lead-task-radios' %>
                        <%= f.radio_button :lead_task, "Rehash", id: 'Rehash', label: "Rehash", inline: true, class: 'lead-task-radios' %>
                        <%= f.radio_button :lead_task, "Sold", id: 'Sold', label: "Sold", inline: true, class: 'lead-task-radios' %>
                      <% end %>
                    <% end %>
                 </td>
               </tr>
              <% end %>
          <% end %>
        </tbody>
      </table>
      <%= will_paginate @events %>
      </div>
      </div>
    </div>
  </div>
</div>
<script>
  $(".lead-task-radios").change(function(){
      $(this).closest('form').submit();
      if($(this).attr('id') !== 'Rehash'){
        var id = '#' + $(this).closest("tr").attr('id');
        $(id).remove();
      }
      $('div#all-leads-table').load(document.URL +  ' div#all-leads-table');
  })
  $(".lead-task-dropdowns").change(function(){
    setTimeout(function(){$('div#task-table').load(document.URL +  ' div#task-table')}, 200);
  })
</script>
